{"m":"//settings\nPOX.setting={\n\tname:\"sample_instancing\",\n\tscale:3.0\n};\n\n//scenedatass\nvar box = new WWModel();\nbox.primitive(\"box\",{wx:0.49,wy:0.5,wz:0.49});\n\n//make instance data\nvar id = [] ;\nvar i = 0 ;\nfor(var x=-50;x<50;x++) {\n\tfor(var y=-50;y<50;y++) {\n\t\tvar t = (Math.atan2(y,x)/Math.PI+1)/2 ;\n\t\tvar r = 1-Math.sqrt(x*x+y*y)/50 ;\n\t\tvar c = WWModel.HSV2RGB(t,0.5,r)\n\t\tid[i++] = (x+0.5) ;\n\t\tid[i++] = Math.floor(Math.random()*2); \n\t\tid[i++] = (y+0.5) ;\n\t\tid[i++] = c[0];\n\t\tid[i++] = c[1] ;\n\t\tid[i++] = c[2] ;\n\t\tid[i++] = 1.0 ;\n\t}\n}\n\nvar scene={\n\tenv:{clear_color:[0.0,0.0,0.0,1.0],cull:false},\n\tfs_uni:{\n\t\tlvec:[0.6,1.0,0.8],\n\t\tmode:0\n\t},\n\tmodel:[\n\t\t{geo:box.objModel(),\n\t\tinst:{attr:[\"ipos\",\"icolor\"],//instanc attribute\n\t\t    data:id,\n\t\t    count:id.length/7,\t//instance count \n\t\t    }\n\t\t},\n\t]\n}\nPOX.setScene(scene);\n\n//sceneupdate\nPOX.update=function(render,cam,time){\n\tvar ret={};\n\tvar m=render.getModelData(0);\n//\trender.data.model[0].mm=new CanvasMatrix4().rotate(time/20,0,1,0);\n\treturn ret;\n}\t\n","vs":"attribute vec3 position;\nattribute vec3 norm;\nattribute vec2 uv ;\nattribute vec3 ipos ;\nattribute vec4 icolor ;\n\nuniform mat4 mvpMatrix;\nuniform mat4 invMatrix;\nuniform vec4 col ;\n\nvarying vec3 tnorm ;\nvarying vec4 color ;\n\nvoid main() {\n\tvec2 uv2 = uv ;\n\tcolor = icolor ;\n\ttnorm = (invMatrix * vec4(norm,0.0)).xyz ;\n\tgl_Position = mvpMatrix * vec4(position+ipos, 1.0) ;\n}\n","fs":"precision highp float;\nuniform int mode ;\nuniform vec4 bcolor ;\nuniform vec3 eyevec ;\nuniform vec3 lvec ;\t\n\nvarying vec3 tnorm ;\nvarying vec4 color ;\n\nvoid main() {\n\tvec3 col = color.xyz ;\n\tvec3 norm = normalize(tnorm) ;\n\tfloat diff= clamp((dot(norm,normalize(lvec))+0.5)/1.5,0.0,1.0);\n\tfloat spec= pow(clamp(dot(norm,normalize(normalize(lvec)+normalize(eyevec))),0.0,1.0),20.0);\n\tvec3 fcolor = col * (diff * 0.8 + 0.2) + vec3(0.6,0.6,1.0)*(spec * 0.8);\n\tgl_FragColor = (mode!=1) ? vec4(fcolor,color.w):vec4(bcolor.x,bcolor.y,bcolor.z,1.0);\n}\n","version":"0.1"}